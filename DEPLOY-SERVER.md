# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ›´æ–°è¯´æ˜

### æœ€æ–°æ›´æ–°ï¼ˆ2024-11-11ï¼‰

âœ… **è´¦å·è½®æ¢æœºåˆ¶ä¼˜åŒ–**
- æ»šçƒï¼šæ¯ **30åˆ†é’Ÿ** è‡ªåŠ¨æ¢è´¦å·
- ä»Šæ—¥ï¼šæ¯ **60åˆ†é’Ÿ** è‡ªåŠ¨æ¢è´¦å·
- æ—©ç›˜ï¼šæ¯ **60åˆ†é’Ÿ** æŠ“å–ä¸€æ¬¡ï¼ŒæŠ“å–åè‡ªåŠ¨é€€å‡ºè´¦å·

âœ… **å¿½ç•¥ CheckEMNU æç¤º**
- é‡åˆ° CheckEMNU æç¤ºæ—¶åªè®°å½•æ—¥å¿—ï¼Œä¸æš‚åœè´¦å·
- æŒ‰æ—¶é—´è½®æ¢ï¼Œä¸å—ä»»ä½•é£é™©æç¤ºå½±å“
- ç¡®ä¿æœåŠ¡æŒç»­è¿è¡Œ

âœ… **è½®æ¢æœºåˆ¶æ”¹è¿›**
- è½®æ¢æ—¶å¼ºåˆ¶å…ˆé€€å‡ºå½“å‰è´¦å·
- ç­‰å¾…3ç§’åå†ç™»å½•æ–°è´¦å·
- é¿å…è´¦å·å†²çª

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. æ‹‰å–æœ€æ–°ä»£ç 

```bash
cd /www/wwwroot/crown-scraper-service
git pull origin main
```

### 2. å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```bash
vim .env
```

**é‡è¦é…ç½®é¡¹ï¼š**

```bash
# æŠ“å–é—´éš”ï¼ˆç§’ï¼‰
LIVE_FETCH_INTERVAL=5          # æ»šçƒï¼šæ¯5ç§’
TODAY_FETCH_INTERVAL=10        # ä»Šæ—¥ï¼šæ¯10ç§’
EARLY_FETCH_INTERVAL=3600      # æ—©ç›˜ï¼šæ¯1å°æ—¶

# è´¦å·è½®æ¢é—´éš”ï¼ˆåˆ†é’Ÿï¼‰
LIVE_ROTATION_MINUTES=30       # æ»šçƒï¼š30åˆ†é’Ÿæ¢è´¦å·
TODAY_ROTATION_MINUTES=60      # ä»Šæ—¥ï¼š60åˆ†é’Ÿæ¢è´¦å·
EARLY_ROTATION_MINUTES=60      # æ—©ç›˜ï¼š60åˆ†é’Ÿæ¢è´¦å·

# æ›´å¤šç›˜å£é…ç½®
ENABLE_MORE_MARKETS=1
MORE_MARKETS_START_DELAY_SECONDS=45
MORE_MARKETS_INTERVAL_MS=25000
MORE_MARKETS_MAX_CONCURRENCY=1
MORE_MARKETS_LIMIT=1
```

### 4. é…ç½®è´¦å·æ± 

**æ–¹å¼ä¸€ï¼šå•è´¦å·é…ç½®**
```bash
LIVE_CROWN_USERNAME=è´¦å·1
LIVE_CROWN_PASSWORD=å¯†ç 1

TODAY_CROWN_USERNAME=è´¦å·2
TODAY_CROWN_PASSWORD=å¯†ç 2

EARLY_CROWN_USERNAME=è´¦å·3
EARLY_CROWN_PASSWORD=å¯†ç 3
```

**æ–¹å¼äºŒï¼šå¤šè´¦å·æ± é…ç½®ï¼ˆæ¨èï¼‰**
```bash
# æ»šçƒè´¦å·æ± ï¼ˆå¤šä¸ªè´¦å·ç”¨é€—å·åˆ†éš”ï¼‰
LIVE_ACCOUNT_POOL=è´¦å·1:å¯†ç 1,è´¦å·2:å¯†ç 2,è´¦å·3:å¯†ç 3

# ä»Šæ—¥è´¦å·æ± 
TODAY_ACCOUNT_POOL=è´¦å·4:å¯†ç 4,è´¦å·5:å¯†ç 5

# æ—©ç›˜è´¦å·æ± 
EARLY_ACCOUNT_POOL=è´¦å·6:å¯†ç 6,è´¦å·7:å¯†ç 7
```

**æ”¯æŒçš„æ ¼å¼ï¼š**
- `è´¦å·:å¯†ç ` æˆ– `è´¦å·/å¯†ç `
- å¤šä¸ªè´¦å·ç”¨ `,` æˆ–æ¢è¡Œåˆ†éš”

### 5. ç¼–è¯‘ä»£ç 

```bash
npm run build
```

### 6. é‡å¯æœåŠ¡

```bash
pm2 restart crown-scraper
```

æˆ–è€…å®Œå…¨é‡æ–°å¯åŠ¨ï¼š

```bash
pm2 delete crown-scraper
pm2 start ecosystem.config.js
```

---

## ğŸ“Š æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
pm2 status crown-scraper
```

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
pm2 logs crown-scraper
```

### æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
```bash
pm2 logs crown-scraper --lines 100
```

### æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```bash
pm2 logs crown-scraper --err
```

---

## ğŸ” éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
./check-status.sh
```

### 2. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
æ—¥å¿—ä¸­åº”è¯¥çœ‹åˆ°ï¼š

```
[live] â° æ—¶é—´åˆ°ï¼ˆ30åˆ†é’Ÿï¼‰ï¼Œå¼€å§‹è½®æ¢è´¦å·
[live] ç›®æ ‡è´¦å·: xxx
[live] âœ… å·²åœæ­¢æŠ“å–ä»»åŠ¡
[live] æ­£åœ¨é€€å‡ºå½“å‰è´¦å·...
[live] âœ… å½“å‰è´¦å·å·²é€€å‡º
[live] ç­‰å¾… 3 ç§’åç™»å½•æ–°è´¦å·...
[live] æ­£åœ¨ç™»å½•æ–°è´¦å·: xxx
[live] âœ… è´¦å·åˆ‡æ¢å®Œæˆ -> xxx
[live] ä¸‹æ¬¡è½®æ¢æ—¶é—´: 30 åˆ†é’Ÿå
```

### 3. æ£€æŸ¥ CheckEMNU å¤„ç†
å¦‚æœé‡åˆ° CheckEMNUï¼Œæ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š

```
[live] æ£€æµ‹åˆ° CheckEMNU å®‰å…¨æ ¡éªŒ (get_game_list/live)ï¼Œå¿½ç•¥å¹¶ç»§ç»­è¿è¡Œ
```

**ä¸ä¼šæš‚åœè´¦å·ï¼Œç»§ç»­æŠ“å–ï¼**

---

## âš™ï¸ é…ç½®è¯´æ˜

### æŠ“å–é—´éš”
- **æ»šçƒ (live)**: 5ç§’ä¸€æ¬¡ï¼Œæ•°æ®æ›´æ–°å¿«
- **ä»Šæ—¥ (today)**: 10ç§’ä¸€æ¬¡ï¼Œå¹³è¡¡æ€§èƒ½
- **æ—©ç›˜ (early)**: 3600ç§’ï¼ˆ1å°æ—¶ï¼‰ä¸€æ¬¡ï¼ŒèŠ‚çœèµ„æº

### è´¦å·è½®æ¢
- **æ»šçƒ**: 30åˆ†é’Ÿæ¢ä¸€æ¬¡ï¼Œé¿å…é¢‘ç¹è§¦å‘é£æ§
- **ä»Šæ—¥**: 60åˆ†é’Ÿæ¢ä¸€æ¬¡ï¼Œç¨³å®šè¿è¡Œ
- **æ—©ç›˜**: 60åˆ†é’ŸæŠ“ä¸€æ¬¡ï¼ŒæŠ“å®Œç«‹å³é€€å‡º

### è½®æ¢æµç¨‹
1. â° æ—¶é—´åˆ° â†’ åœæ­¢æŠ“å–
2. ğŸšª é€€å‡ºå½“å‰è´¦å·
3. â³ ç­‰å¾…3ç§’
4. ğŸ”‘ ç™»å½•æ–°è´¦å·
5. â–¶ï¸ å¼€å§‹æŠ“å–

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ·»åŠ æ›´å¤šè´¦å·ï¼Ÿ
ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œåœ¨å¯¹åº”çš„ `ACCOUNT_POOL` ä¸­æ·»åŠ ï¼š
```bash
LIVE_ACCOUNT_POOL=è´¦å·1:å¯†ç 1,è´¦å·2:å¯†ç 2,æ–°è´¦å·:æ–°å¯†ç 
```

### Q2: å¦‚ä½•ä¿®æ”¹è½®æ¢æ—¶é—´ï¼Ÿ
ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```bash
LIVE_ROTATION_MINUTES=45  # æ”¹ä¸º45åˆ†é’Ÿ
```

### Q3: é‡åˆ° CheckEMNU æ€ä¹ˆåŠï¼Ÿ
ä¸ç”¨æ‹…å¿ƒï¼ç³»ç»Ÿä¼šè‡ªåŠ¨å¿½ç•¥ï¼Œç»§ç»­è¿è¡Œã€‚æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å³å¯ã€‚

### Q4: å¦‚ä½•æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„è´¦å·ï¼Ÿ
æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
pm2 logs crown-scraper | grep "è´¦å·åˆ‡æ¢å®Œæˆ"
```

### Q5: æ—©ç›˜ä¸ºä»€ä¹ˆä¸æŒç»­æŠ“å–ï¼Ÿ
æ—©ç›˜æ•°æ®æ›´æ–°æ…¢ï¼Œæ¯å°æ—¶æŠ“ä¸€æ¬¡å³å¯ã€‚æŠ“å–åè‡ªåŠ¨é€€å‡ºè´¦å·ï¼ŒèŠ‚çœèµ„æºã€‚

---

## ğŸ“ æ—¥å¿—è¯´æ˜

### æ­£å¸¸æ—¥å¿—
```
[live] å¼€å§‹æŠ“å–...
[live] æŠ“å–å®Œæˆï¼Œå…± 150 åœºèµ›äº‹
[live] â° æ—¶é—´åˆ°ï¼ˆ30åˆ†é’Ÿï¼‰ï¼Œå¼€å§‹è½®æ¢è´¦å·
[live] âœ… è´¦å·åˆ‡æ¢å®Œæˆ -> xxx
```

### CheckEMNU æ—¥å¿—
```
[live] æ£€æµ‹åˆ° CheckEMNU å®‰å…¨æ ¡éªŒï¼Œå¿½ç•¥å¹¶ç»§ç»­è¿è¡Œ
```

### é”™è¯¯æ—¥å¿—
```
[live] âŒ æŠ“å–å¤±è´¥: xxx
[live] âŒ è´¦å·è½®æ¢å¤±è´¥: xxx
```

---

## ğŸ”„ å›æ»šæ“ä½œ

å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼š

```bash
cd /www/wwwroot/crown-scraper-service
git log --oneline -5  # æŸ¥çœ‹æœ€è¿‘5æ¬¡æäº¤
git reset --hard <commit-hash>  # å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
npm run build
pm2 restart crown-scraper
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. PM2 æ—¥å¿—ï¼š`pm2 logs crown-scraper`
2. ç³»ç»Ÿæ—¥å¿—ï¼š`./logs/combined.log`
3. é”™è¯¯æ—¥å¿—ï¼š`./logs/error.log`

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æ‹‰å–æœ€æ–°ä»£ç 
- [ ] é…ç½® `.env` æ–‡ä»¶
- [ ] é…ç½®è´¦å·æ± 
- [ ] è¿è¡Œ `npm run build`
- [ ] é‡å¯æœåŠ¡ `pm2 restart crown-scraper`
- [ ] æŸ¥çœ‹æ—¥å¿—ç¡®è®¤è¿è¡Œæ­£å¸¸
- [ ] éªŒè¯è´¦å·è½®æ¢åŠŸèƒ½
- [ ] éªŒè¯ CheckEMNU å¿½ç•¥åŠŸèƒ½

